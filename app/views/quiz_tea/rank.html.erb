<script>
  function courseAlertShow(type, msg) {
		$("#course_alert").addClass( type );
		$("#course_alert").html("<button type='button' class='close' onclick='$(\"#course_alert\").hide()'><span aria-hidden='true'>&times;</span><span class='sr-only'>Close</span></button>"+msg)
		$("#course_alert").show(600).delay(2000).slideUp(600, function(){
	    	$("#course_alert").removeClass( type );
		    $("#course_alert").html("");
	    }); 			
  }    
  $(function () {
	$("#course_alert").hide();
  })  
</script>
<div class="alert alert-success alert-dismissible fade in" id="course_alert"></div>	 	
<div id="question_list"></div>
<script>
	var sheet_contents;
	function addQuestion(index, course_id, pool_id, question_id, category, subject, options, comment) {
		var sheet;
		$.each( sheet_contents, function( key, value ) {
			if(value.PoolId==pool_id)
			{
				sheet = value;
				return false
			}
		});
				
		var $div_question_container = $("<div>", {id: "question_container_"+question_id, class: "question_eg"});	
			//question_eg_question_outter
		var $question_eg_question_outter =$("<div>", {class: "row question_eg_question_outter"}); 
			$question_eg_question_outter.append('<div class="col-sm-1"></div>');			
			$question_eg_question_outter.append('<div class="col-sm-1">'+index+'.</div>');		
			$question_eg_question_outter.append('<div class="col-sm-7 question_eg_question_container">'+subject+'</div>');		
		var $question_eg_question_note= $("<div>", {class: "col-sm-1"}); 
			$question_eg_question_outter.append($question_eg_question_note);			
		var $question_eg_question_mani_container= $("<div>", {class: "col-sm-1"}); 	
		//var $span_edit = $("<span>", {id: "pool_edit_"+pool_id, class: "question_eg_question_mani glyphicon glyphicon-edit", 'aria-hidden': "true"});
			//$question_eg_question_mani_container.append($span_edit)
		var $score = $("<input>", {id: "pool_score_"+pool_id, type: 'text', val: sheet.MatchRate});
			$question_eg_question_mani_container.append($score)
			$question_eg_question_outter.append($question_eg_question_mani_container);		
			$div_question_container.append($question_eg_question_outter);	
			//question_eg_comment_outter
		if(comment){
			var $question_eg_comment_outter =$("<div>", {class: "row question_eg_comment_outter"}); 
				$question_eg_comment_outter.append('<div class="col-sm-2"></div>');	
				$question_eg_comment_outter.append('<div class="col-sm-7 question_eg_options_comment">回饋：'+comment+'</div>');	
				$div_question_container.append($question_eg_comment_outter);	
		}
			//question_eg_options_title_outter			
		var $question_eg_options_title_outter =$("<div>", {class: "row question_eg_options_title_outter"}); 
			$question_eg_options_title_outter.append('<div class="col-sm-2"></div>');	
		var $question_eg_options_title =$("<div>", {class: "col-sm-7 question_eg_options_title"}); 
			$question_eg_options_title_outter.append($question_eg_options_title);
			$div_question_container.append($question_eg_options_title_outter);	
			//question_eg_options_outter				
		var $question_eg_options_outter =$("<div>", {class: "row question_eg_options_outter"}); 
			$question_eg_options_outter.append('<div class="col-sm-2"></div>');	
		var $question_eg_options_container =$("<div>", {class: "col-sm-7 question_eg_options_container"}); 			
			$question_eg_options_outter.append($question_eg_options_container);
			$div_question_container.append($question_eg_options_outter);										  
		//category process
		switch(category.toString()) {
	    case '5':
	    	$question_eg_options_title.html('參考答案');
			$question_eg_question_note.html('填充');	    	
			for(firstKey in options);
			if(typeof firstKey != 'undefined') 
				$question_eg_options_container.html(options[firstKey].content);					
	        break;
	    case '2':	    
	    	$question_eg_options_title.html('選項與答案');
			$question_eg_question_note.html('單選');	 	    		    
			$.each( options, function( k, v ){				
				var $div_radio_container = $("<div>", {id: "question_container_"+question_id, class: "radio disabled"});	
				var $div_label_container = $("<label>", {});	
				if(v.isAnswer) 
					$div_label_container.append('<input type="radio" name="optionsRadios_'+pool_id+'" id="optionsRadios'+v.option_id+'" checked="checked" disabled>'+v.content);
				else
					$div_label_container.append('<input type="radio" name="optionsRadios_'+pool_id+'" id="optionsRadios'+v.option_id+'" disabled>'+v.content);					
				$div_radio_container.append($div_label_container);
				$question_eg_options_container.append($div_radio_container);
			});	    	
	        break;
	    case '3':
	    	$question_eg_options_title.html('選項與答案');
			$question_eg_question_note.html('複選');	 	    		    
			$.each( options, function( k, v ){				
				var $div_radio_container = $("<div>", {id: "question_container_"+question_id, class: "radio disabled"});	
				var $div_label_container = $("<label>", {});	
				if(v.isAnswer) 
					$div_label_container.append('<input type="checkbox" name="optionsRadios_'+pool_id+'" id="optionsRadios'+v.option_id+'" checked="checked" disabled>'+v.content);
				else
					$div_label_container.append('<input type="checkbox" name="optionsRadios_'+pool_id+'" id="optionsRadios'+v.option_id+'" disabled>'+v.content);					
				$div_radio_container.append($div_label_container);
				$question_eg_options_container.append($div_radio_container);
			});	    	    
	        break;
	    case '1':
	    	$question_eg_options_title.html('選項與答案');
			$question_eg_question_note.html('是非');	 	    		    
			$.each( options, function( k, v ){				
				var $div_radio_container = $("<div>", {id: "question_container_"+question_id, class: "radio disabled"});	
				var $div_label_container = $("<label>", {});	
				if(v.isAnswer) 
					$div_label_container.append('<input type="radio" name="optionsRadios_'+pool_id+'" id="optionsRadios'+v.option_id+'" checked="checked" disabled>'+v.content);
				else
					$div_label_container.append('<input type="radio" name="optionsRadios_'+pool_id+'" id="optionsRadios'+v.option_id+'" disabled>'+v.content);					
				$div_radio_container.append($div_label_container);
				$question_eg_options_container.append($div_radio_container);
			});	    	    
	        break;		
		} 	
		$score.change(function(){  
			$.ajax({
				type: "GET",
				url: "/quiz_tea/submitScore",
				data: { PoolId: pool_id, SubmitId: '<%=@submit_id%>', Score: $("#pool_score_"+pool_id).val(), quiz_id: '<%=@quiz_id%>', course_id: '<%=@course_id%>'},
				datatype : 'json',
				success : function(data) {
					if (data.success) {
						courseAlertShow('alert-success', data.message)											
					} else {
						courseAlertShow('alert-danger', data.message)
					}
				}			
			});						
		});			
		$('#question_list').append($div_question_container);
	}	
	// list Question
	function questionList()
	{
		$('#question_list').empty();
		$.ajax({
			type: "GET",
			url: "/quiz_tea/listQuestions",
			data: { QuizId: '<%= @quiz_id%>', Draft: false},
			datatype : 'json',
			success : function(data) {
				if (data.success) {
					//courseAlertShow('alert-success', data.msg)
					var index=0;
					$.each( data.pools, function( k, v ){
						index++;
						addQuestion(index, v.course_id, v.pool_id, v.question_id, v.category, v.subject, v.options, v.comment);	
					});											
				} else {
					courseAlertShow('alert-danger', data.message)
				}
			}			
		});	
	}


$(function() {	
	$.ajax({
				type: "GET",
				async: false,
				url: "/quiz_tea/getAnswerAndScore",
				data: { SubmitId: '<%= @submit_id%>'},
				datatype : 'json',
				success : function(data) {
					if (data.success) {
						courseAlertShow('alert-success', data.sheet_contents)										
						sheet_contents = data.sheet_contents
					} else {
						courseAlertShow('alert-danger', data.message)
					}
				}			
			});		
	questionList();  	
	       
});
</script>